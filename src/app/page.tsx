import { prisma } from '@/lib/db'; import ListingCard from '@/components/ListingCard'; export const revalidate=0; function parse(searchParams:any){const q=(searchParams.q||'').trim(); const category=searchParams.category||''; const min=Number(searchParams.min||0)||0; const max=Number(searchParams.max||0)||0; return {q,category,min,max}; } export default async function HomePage({ searchParams }:{ searchParams:any }){ const {q,category,min,max}=parse(searchParams); const where:any={status:'ACTIVE'}; if(q) where.OR=[{title:{contains:q,mode:'insensitive'}},{description:{contains:q,mode:'insensitive'}}]; if(category) where.category={slug:category}; if(min) where.priceCents={gte:min*100}; if(max) where.priceCents={...(where.priceCents||{}), lte:max*100}; const [listings,categories]=await Promise.all([ prisma.listing.findMany({ where, orderBy:{createdAt:'desc'}, include:{category:true} }), prisma.category.findMany({ orderBy:{name:'asc'} }) ]); return (<div className='space-y-6'><div className='card'><form className='grid md:grid-cols-6 gap-3'><input name='q' placeholder='Søg efter hunde eller udstyr...' defaultValue={q} className='input md:col-span-2'/><select name='category' defaultValue={category} className='input'><option value=''>Alle kategorier</option>{categories.map(c=> <option key={c.id} value={c.slug}>{c.name}</option>)}</select><input name='min' type='number' min='0' placeholder='Min pris' defaultValue={min||''} className='input'/><input name='max' type='number' min='0' placeholder='Max pris' defaultValue={max||''} className='input'/><button className='btn btn-primary'>Søg</button></form></div><div className='flex items-center justify-between'><h1 className='text-2xl font-semibold'>Seneste opslag</h1><p className='text-sm text-gray-600'>Kontakt sælger direkte – ingen betalinger via platformen.</p></div><div className='grid-cards'>{listings.map(l=> <ListingCard key={l.id} listing={l}/>)}</div>{listings.length===0 && <p className='text-gray-600'>Ingen opslag matcher dine filtre.</p>}</div>); }